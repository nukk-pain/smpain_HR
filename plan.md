# HR 시스템 문제 해결 진단 및 수정 계획

## 현재 상황
- 3가지 주요 문제가 발견됨:
  1. 사용자 삭제가 안됨
  2. 직책(positions)이 새로 생겼는데 보이지 않음
  3. 부서 삭제가 제대로 되지 않음

## 접근 방식
**가정**: 모든 기능은 이미 구현되어 있음. 문제는 연결이나 호출 부분에 있을 것임.
- 구현 → 진단 → 연결 수정 순서로 진행
- 기존 코드 확인 후 누락된 연결 부분만 수정

### Phase 1: 사용자 삭제 기능 진단 및 수정 ✅ 완료

#### Step 1-1: 백엔드 사용자 삭제 API 상태 확인 ✅
- [✓] **진단**: `DELETE /api/users/:id` 엔드포인트 구현 여부 확인 - 구현되어 있음
- [✓] **진단**: 권한 체크 로직 확인 - `users:delete` 권한 체크
- [✓] **진단**: Admin끼리 삭제 제한 - 현재 상태 유지 (B방법 선택)
- [✓] **확인**: Admin이 User/Supervisor 삭제 못하는 문제 파악

**문제점 발견 및 해결:**
- 프론트엔드가 클라우드 백엔드 대신 로컬 백엔드로 연결하도록 `.env.development` 수정
- API URL을 `http://localhost:5455/api`로 변경

#### Step 1-2: 프론트엔드 사용자 삭제 UI 연결 확인 ✅
- [✓] **진단**: 사용자 목록에서 삭제 버튼 존재 여부 확인 - 정상 작동
- [✓] **테스트**: admin/admin으로 로그인하여 일반 사용자 삭제 기능 확인
- [✓] **확인**: 삭제 후 목록 새로고침 로직 정상 작동

### Phase 2: 직책(Positions) 표시 기능 진단 및 수정 ✅ 완료

#### Step 2-1: 데이터베이스 Positions 데이터 상태 확인 ✅
- [✓] **진단**: MongoDB에서 positions 컬렉션/필드 존재 여부 확인 - 컬렉션 존재함
- [✓] **진단**: 실제 positions 데이터가 저장되어 있는지 확인 - 데이터 없음
- [✓] **진단**: 데이터 구조 및 필드명 확인

**문제점 발견 및 해결:**
- positions 컬렉션이 비어있어서 표시할 데이터가 없었음
- 테스트 직책 데이터 추가: "소프트웨어 개발자", "프로젝트 매니저", "디자이너"

#### Step 2-2: 백엔드 Positions API 상태 확인 ✅
- [✓] **진단**: `GET /api/positions` 엔드포인트 구현 여부 확인 - 완전히 구현되어 있음
- [✓] **진단**: API 응답 데이터 형식 확인 - 정상 응답
- [✓] **테스트**: API 호출하여 새로 생성한 직책들 반환 확인

#### Step 2-3: 프론트엔드 Positions 표시 연결 확인 ✅
- [✓] **진단**: positions 데이터 정상 표시 확인

### Phase 3: 부서 삭제 기능 진단 및 수정 ✅ 완료

#### Step 3-1: 백엔드 부서 삭제 API 상태 확인 ✅
- [✓] **진단**: `DELETE /api/departments/:id` 엔드포인트 구현 여부 확인 - 구현되어 있음
- [✓] **진단**: 소속 사용자 존재 시 삭제 방지 로직 확인 - 정상 작동
- [✓] **진단**: 권한 체크 로직 확인 - `departments:manage` 권한 체크

**문제점 발견 및 해결:**
- 백엔드 API에서 직원 수 확인 후 성공 메시지만 반환하고 실제 삭제 작업을 수행하지 않았음
- 실제 삭제 로직 추가 (soft delete: `isActive: false` 설정)
- 부서 이름으로 직원 검색하도록 로직 수정

#### Step 3-2: 프론트엔드 부서 삭제 UI 연결 확인 ✅
- [✓] **진단**: 부서 목록에서 삭제 버튼 존재 여부 확인 - 정상 존재
- [✓] **테스트**: 테스트 부서 생성 및 삭제 기능 확인
- [✓] **확인**: 삭제 후 부서 목록에서 제거됨을 확인

## 진단 및 수정 규칙

1. **진단 → 수정 → 테스트** 순서로 진행
2. 기존 구현부터 확인하고 누락된 연결 부분만 수정
3. 각 Step 완료 시마다 체크표시(✓) 추가
4. 구조적 변경과 기능적 변경 분리
5. 커밋은 명시적 요청 시에만 실행

## 진단 방법

```bash
# 브라우저에서 실제 동작 테스트
# 개발자 도구로 네트워크 요청 및 콘솔 에러 확인
# 코드에서 구현 상태 확인

# 백엔드 API 직접 테스트
curl -X DELETE http://localhost:5456/api/users/123 \
  -H "Authorization: Bearer YOUR_TOKEN"

# MongoDB 데이터 확인
mongosh mongodb://localhost:27017/SM_nomu
```

## 다음 단계
1. Step 1-1부터 순차적으로 진행
2. 기존 구현 상태 확인 후 문제점 파악
3. 최소한의 수정으로 연결 문제 해결
4. 실제 동작 테스트로 검증