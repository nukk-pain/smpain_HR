# JWT ì „í™˜ í›„ ëŒ€ì‹œë³´ë“œ ì˜¤ë¥˜ í…ŒìŠ¤íŠ¸ ê³„íš

## ë¬¸ì œ ìƒí™©
- JWT ì¸ì¦ìœ¼ë¡œ ì „í™˜ ì™„ë£Œ
- ë¡œê·¸ì¸ì€ ì„±ê³µí•˜ì§€ë§Œ ëŒ€ì‹œë³´ë“œì—ì„œ ë§ì€ ì˜¤ë¥˜ ë°œìƒ ì˜ˆìƒ
- ê¸°ì¡´ ì½”ë“œë“¤ì´ ì—¬ì „íˆ `req.session.user` ì‚¬ìš©

## í…ŒìŠ¤íŠ¸ ëª©í‘œ
1. JWT ì „í™˜ í›„ ë°œìƒí•˜ëŠ” ëª¨ë“  ì˜¤ë¥˜ ì‹ë³„
2. `req.session.user`ë¥¼ `req.user`ë¡œ ë³€ê²½ í•„ìš”í•œ íŒŒì¼ë“¤ ì°¾ê¸°
3. ëŒ€ì‹œë³´ë“œ ì£¼ìš” ê¸°ëŠ¥ë³„ ì˜¤ë¥˜ ë¶„ì„
4. ì²´ê³„ì ì¸ ìˆ˜ì • ê³„íš ìˆ˜ë¦½

## í…ŒìŠ¤íŠ¸ ë‹¨ê³„

### 1ë‹¨ê³„: ë°±ì—”ë“œ ì •ì  ë¶„ì„ âœ… ì™„ë£Œ
#### 1.1 ì„¸ì…˜ ì‚¬ìš© ì½”ë“œ ì „ì²´ ê²€ìƒ‰ âœ…
- [x] `req.session.user` ì‚¬ìš©í•˜ëŠ” ëª¨ë“  íŒŒì¼ ì‹ë³„ (19ê°œ íŒŒì¼)
- [x] ê° íŒŒì¼ë³„ ìˆ˜ì • í•„ìš”í•œ ë¼ì¸ ìˆ˜ íŒŒì•…
- [x] ìš°ì„ ìˆœìœ„ë³„ íŒŒì¼ ë¶„ë¥˜ (í•µì‹¬ API vs ë¶€ê°€ ê¸°ëŠ¥)
- [x] **ëª¨ë“  `req.session.user` â†’ `req.user`ë¡œ ì¼ê´„ ë³€ê²½ ì™„ë£Œ**

#### 1.2 ì£¼ìš” API ì—”ë“œí¬ì¸íŠ¸ ë¶„ì„
**ì‚¬ìš©ì ê´€ë¦¬ API (`/api/users/*`)**
- [ ] GET /api/users - ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
- [ ] POST /api/users - ì‚¬ìš©ì ìƒì„±  
- [ ] PUT /api/users/:id - ì‚¬ìš©ì ìˆ˜ì •
- [ ] DELETE /api/users/:id - ì‚¬ìš©ì ì‚­ì œ

**íœ´ê°€ ê´€ë¦¬ API (`/api/leave/*`)**
- [ ] GET /api/leave/requests - íœ´ê°€ ì‹ ì²­ ëª©ë¡
- [ ] POST /api/leave/requests - íœ´ê°€ ì‹ ì²­ ìƒì„±
- [ ] PUT /api/leave/requests/:id - íœ´ê°€ ì‹ ì²­ ìˆ˜ì •
- [ ] POST /api/leave/approve/:id - íœ´ê°€ ìŠ¹ì¸

**ê¸‰ì—¬ ê´€ë¦¬ API (`/api/payroll/*`)**
- [ ] GET /api/payroll - ê¸‰ì—¬ ëª©ë¡
- [ ] POST /api/payroll - ê¸‰ì—¬ ìƒì„±
- [ ] PUT /api/payroll/:id - ê¸‰ì—¬ ìˆ˜ì •

**ë³´ê³ ì„œ API (`/api/reports/*`)**
- [ ] GET /api/reports/* - ê°ì¢… ë³´ê³ ì„œ ìƒì„±

**ê´€ë¦¬ì API (`/api/admin/*`)**
- [ ] ê´€ë¦¬ì ì „ìš© ê¸°ëŠ¥ë“¤

### 2ë‹¨ê³„: í”„ë¡ íŠ¸ì—”ë“œ ë™ì  í…ŒìŠ¤íŠ¸
#### 2.1 ë¡œê·¸ì¸ í›„ ëŒ€ì‹œë³´ë“œ ì ‘ê·¼
- [ ] ë¡œê·¸ì¸ ì„±ê³µ ì—¬ë¶€ í™•ì¸
- [ ] JWT í† í° ì €ì¥ í™•ì¸
- [ ] ëŒ€ì‹œë³´ë“œ ë Œë”ë§ í™•ì¸

#### 2.2 ëŒ€ì‹œë³´ë“œ ì£¼ìš” ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
**UnifiedDashboard**
- [ ] ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
- [ ] íœ´ê°€ ì”ì—¬ì¼ í‘œì‹œ
- [ ] ìµœê·¼ í™œë™ í‘œì‹œ
- [ ] ê¶Œí•œë³„ ë©”ë‰´ í‘œì‹œ

**UserManagement** 
- [ ] ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ
- [ ] ì‚¬ìš©ì ìƒì„±/ìˆ˜ì •/ì‚­ì œ
- [ ] ê¶Œí•œ ê´€ë¦¬

**LeaveManagement**
- [ ] íœ´ê°€ ì‹ ì²­ ëª©ë¡ ë¡œë“œ
- [ ] íœ´ê°€ ì‹ ì²­ ìƒì„±
- [ ] íœ´ê°€ ìŠ¹ì¸/ê±°ë¶€

**PayrollManagement**
- [ ] ê¸‰ì—¬ ë°ì´í„° ë¡œë“œ
- [ ] ê¸‰ì—¬ ê³„ì‚°
- [ ] ê¸‰ì—¬ ëª…ì„¸ì„œ ìƒì„±

### 3ë‹¨ê³„: ë¸Œë¼ìš°ì € ë„¤íŠ¸ì›Œí¬ ë¶„ì„
#### 3.1 API ìš”ì²­ ë¶„ì„
- [ ] Authorization í—¤ë” í¬í•¨ ì—¬ë¶€
- [ ] 401/403 ì˜¤ë¥˜ ë°œìƒ APIë“¤ ì‹ë³„
- [ ] ì„±ê³µí•˜ëŠ” API vs ì‹¤íŒ¨í•˜ëŠ” API ë¶„ë¥˜

#### 3.2 ì½˜ì†” ì˜¤ë¥˜ ë¶„ì„
- [ ] JavaScript ëŸ°íƒ€ì„ ì˜¤ë¥˜
- [ ] API í˜¸ì¶œ ì˜¤ë¥˜ 
- [ ] React ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ ì˜¤ë¥˜

### 4ë‹¨ê³„: ì²´ê³„ì  ìˆ˜ì •
#### 4.1 ìš°ì„ ìˆœìœ„ë³„ ìˆ˜ì • ê³„íš
**High Priority (ëŒ€ì‹œë³´ë“œ í•µì‹¬ ê¸°ëŠ¥)**
1. `/api/auth/me` - ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ âœ… (ì´ë¯¸ ì™„ë£Œ)
2. `/api/users/*` - ì‚¬ìš©ì ê´€ë¦¬
3. `/api/leave/requests` - íœ´ê°€ ì‹ ì²­ ëª©ë¡

**Medium Priority (ì£¼ìš” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)**
4. `/api/leave/approve` - íœ´ê°€ ìŠ¹ì¸
5. `/api/payroll/*` - ê¸‰ì—¬ ê´€ë¦¬
6. `/api/departments/*` - ë¶€ì„œ ê´€ë¦¬

**Low Priority (ë¶€ê°€ ê¸°ëŠ¥)**
7. `/api/reports/*` - ë³´ê³ ì„œ
8. `/api/admin/*` - ê´€ë¦¬ ê¸°ëŠ¥
9. `/api/upload/*` - íŒŒì¼ ì—…ë¡œë“œ

#### 4.2 ìˆ˜ì • ë°©ë²•ë¡ 
1. **ì¼ê´„ ì¹˜í™˜**: `req.session.user` â†’ `req.user`
2. **í•„ë“œ ë§¤í•‘**: `req.session.user.id` â†’ `req.user.id`
3. **ì—ëŸ¬ í•¸ë“¤ë§**: JWT ê´€ë ¨ ì˜¤ë¥˜ ì²˜ë¦¬ ì¶”ê°€
4. **í…ŒìŠ¤íŠ¸**: ê° ìˆ˜ì • í›„ í•´ë‹¹ API í…ŒìŠ¤íŠ¸

## ì˜ˆìƒ ìˆ˜ì • í•„ìš” íŒŒì¼ ëª©ë¡

### âœ… ìˆ˜ì • ì™„ë£Œëœ íŒŒì¼ë“¤

**ğŸ”´ High Priority (ì™„ë£Œ)**
```
âœ… /backend/routes/users.js - 13 occurrences â†’ req.user ë³€ê²½ ì™„ë£Œ
âœ… /backend/routes/leave-refactored.js - 9 occurrences â†’ req.user ë³€ê²½ ì™„ë£Œ
âœ… /backend/routes/leave/leaveRequests.js - 10 occurrences â†’ req.user ë³€ê²½ ì™„ë£Œ
```

**ğŸŸ¡ Medium Priority (ì™„ë£Œ)**
```
âœ… /backend/routes/payroll.js - 7 occurrences â†’ req.user ë³€ê²½ ì™„ë£Œ
âœ… /backend/routes/departments.js - ë³€ê²½ ì™„ë£Œ
âœ… /backend/routes/sales.js - ë³€ê²½ ì™„ë£Œ
âœ… /backend/routes/bonus.js - ë³€ê²½ ì™„ë£Œ
```

**ğŸŸ¢ Low Priority (ì™„ë£Œ)**
```
âœ… /backend/routes/reports.js - ë³€ê²½ ì™„ë£Œ
âœ… /backend/routes/admin.js - ë³€ê²½ ì™„ë£Œ
âœ… /backend/routes/upload.js - ë³€ê²½ ì™„ë£Œ
âœ… /backend/routes/positions.js - ë³€ê²½ ì™„ë£Œ
âœ… /backend/routes/users-refactored.js - ë³€ê²½ ì™„ë£Œ
```

**ì¶”ê°€ ìˆ˜ì • íŒŒì¼ë“¤ (ì™„ë£Œ)**
```
âœ… /backend/routes/leave/leaveCalendar.js - ë³€ê²½ ì™„ë£Œ
âœ… /backend/routes/leave/leaveBalance.js - ë³€ê²½ ì™„ë£Œ
âœ… /backend/routes/leave/leaveApproval.js - ë³€ê²½ ì™„ë£Œ
âœ… /backend/routes/leave/leaveCancellation.js - ë³€ê²½ ì™„ë£Œ
âœ… /backend/routes/leave/leaveExceptions.js - ë³€ê²½ ì™„ë£Œ
âœ… /backend/routes/leave/utils/leaveHelpers.js - ë³€ê²½ ì™„ë£Œ
âœ… /backend/middleware/performance.js - ë³€ê²½ ì™„ë£Œ
```

**ğŸ‰ ì´ 19ê°œ íŒŒì¼ ëª¨ë“  `req.session.user` â†’ `req.user` ë³€ê²½ ì™„ë£Œ!**

## í…ŒìŠ¤íŠ¸ ë„êµ¬
1. **ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬**
   - Network tabìœ¼ë¡œ API ìš”ì²­/ì‘ë‹µ ë¶„ì„
   - Console tabìœ¼ë¡œ JavaScript ì˜¤ë¥˜ í™•ì¸

2. **curl ëª…ë ¹ì–´**
   - ê°œë³„ API ì—”ë“œí¬ì¸íŠ¸ ì§ì ‘ í…ŒìŠ¤íŠ¸
   - JWT í† í° í¬í•¨í•œ ìš”ì²­ í…ŒìŠ¤íŠ¸

3. **Postman/Insomnia**
   - API ì»¬ë ‰ì…˜ ìƒì„±í•´ì„œ ì²´ê³„ì  í…ŒìŠ¤íŠ¸

## ì„±ê³µ ê¸°ì¤€
- [ ] ë¡œê·¸ì¸ í›„ ëŒ€ì‹œë³´ë“œ ì™„ì „ ë¡œë“œ
- [ ] ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ ì„±ê³µ
- [ ] íœ´ê°€ ì‹ ì²­ ëª©ë¡ ì¡°íšŒ ì„±ê³µ  
- [ ] ê¸‰ì—¬ ì •ë³´ ì¡°íšŒ ì„±ê³µ
- [ ] ê¶Œí•œë³„ ë©”ë‰´ ì •ìƒ í‘œì‹œ
- [ ] ëª¨ë“  CRUD ì‘ì—… ì •ìƒ ì‘ë™
- [ ] ì½˜ì†”ì— JWT ê´€ë ¨ ì˜¤ë¥˜ ì—†ìŒ

## ì˜ˆìƒ ì†Œìš” ì‹œê°„
- **ë¶„ì„**: 30ë¶„
- **High Priority ìˆ˜ì •**: 1ì‹œê°„
- **Medium Priority ìˆ˜ì •**: 1ì‹œê°„  
- **Low Priority ìˆ˜ì •**: 30ë¶„
- **í…ŒìŠ¤íŠ¸ ë° ê²€ì¦**: 30ë¶„
- **ì´ ì˜ˆìƒ ì‹œê°„**: 3.5ì‹œê°„

## ìœ„í—˜ ìš”ì†Œ
1. **ë°ì´í„°ë² ì´ìŠ¤ ì˜ì¡´ì„±**: ì¼ë¶€ APIê°€ íŠ¹ì • DB ìƒíƒœë¥¼ ìš”êµ¬í•  ìˆ˜ ìˆìŒ
2. **ê¶Œí•œ ì²´ê³„**: JWTì˜ ê¶Œí•œ ì •ë³´ê°€ ê¸°ì¡´ ì„¸ì…˜ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ
3. **ì¤‘ì²©ëœ ì˜¤ë¥˜**: í•œ API ì˜¤ë¥˜ê°€ ë‹¤ë¥¸ APIì— ì—°ì‡„ ì˜í–¥
4. **í”„ë¡ íŠ¸ì—”ë“œ íƒ€ì… ì˜¤ë¥˜**: TypeScript íƒ€ì… ë¶ˆì¼ì¹˜ë¡œ ì¸í•œ ì¶”ê°€ ìˆ˜ì • í•„ìš”

## ë¡¤ë°± ê³„íš
- Git ë¸Œëœì¹˜ë¡œ í˜„ì¬ ìƒíƒœ ë°±ì—…
- ê° íŒŒì¼ ìˆ˜ì • ì „ ê°œë³„ ë°±ì—…
- ë¬¸ì œ ë°œìƒ ì‹œ ì„¸ì…˜ ê¸°ë°˜ ì¸ì¦ìœ¼ë¡œ ì¦‰ì‹œ ë¡¤ë°± ê°€ëŠ¥