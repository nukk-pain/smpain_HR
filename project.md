# 통합 근태 및 급여 관리 시스템 프로젝트

## 1. 프로젝트 개요

### 목적
Synology NAS 기반의 웹 애플리케이션으로, 직원의 근태관리(휴가 신청/승인)와 급여관리(인센티브, 상여금, 포상금)를 통합한 시스템을 구축하여 인사업무 전반을 효율화하고 노무사와의 협업을 원활하게 하는 것을 목표로 함.

### 현재 상태
- **Leave Management System**: Flask 기반으로 구현된 휴가 관리 시스템 (운영 중)
- **Payroll Management System**: 설계 문서 작성 완료, 개발 예정

## 2. 시스템 통합 계획

### 2.1 기존 시스템 분석
현재 Flask 기반 휴가 관리 시스템이 운영 중이며, 다음과 같은 기능들이 구현되어 있음:
- 사용자 인증 및 권한 관리 (admin, manager, user)
- 휴가 신청 및 승인 워크플로우
- 휴가 잔여일 추적 (기본 15일)
- 감사 로그 기능

### 2.2 통합 전략
기존 Flask 시스템을 점진적으로 현대화하면서 급여 관리 기능을 추가:

1. **Phase 1**: 기존 Flask 시스템 유지하면서 급여 관리 기능 추가
2. **Phase 2**: 프론트엔드를 React + AG Grid로 단계적 교체
3. **Phase 3**: 백엔드를 FastAPI로 마이그레이션 (선택사항)

## 3. 기술 스택

### 3.1 현재 기술 스택 (Phase 1)
| 구성 요소 | 기술 |
|-----------|------|
| Backend | Flask (Python) |
| Frontend | Jinja2 Templates + Bootstrap |
| Database | SQLite |
| Authentication | Session-based |
| Deployment | PM2 + Docker |

### 3.2 목표 기술 스택 (Phase 2-3)
| 구성 요소 | 기술 |
|-----------|------|
| Frontend | React + AG Grid |
| Backend | FastAPI (Python) or Flask (유지) |
| Database | SQLite → PostgreSQL (확장 시) |
| Excel 처리 | Pandas, openpyxl |
| PDF 변환 | html2pdf.js, jspdf (프론트) or WeasyPrint (백엔드) |
| 배포 | Synology NAS + Docker |
| Grid UI | AG Grid (무료, 강력한 기능) |

## 4. 핵심 기능

### 4.1 휴가 관리 시스템 (기존)
- ✅ 휴가 신청 및 승인 워크플로우
- ✅ 휴가 잔여일 추적 (기본 15일)
- ✅ 감사 로그 기능
- ✅ 역할 기반 접근 제어 (admin, manager, user)

### 4.2 급여 관리 시스템 (신규)
#### 입력 기능
- 월별 급여, 인센티브, 상여금, 포상금 직접 입력
- 상여금/포상금은 수시 입력 가능, 해당 월에 자동 반영
- 노무사 지급 확정 엑셀 파일 업로드 기능

#### 자동 처리 기능
- 직원별 인센티브 계산 기준에 따라 자동 계산
- 노무사 파일과 입력값 비교 → 차액 표시

#### 조회/관리 기능
- 월별 전체 지급 내역 조회 (직원별/항목별)
- 직원 본인은 자기 내역만 조회 가능
- 연간 지급 총액, 월별 합계 등 통계 표시

#### 보고서 기능
- 관리자가 버튼 클릭 시 PDF로 월별 보고서 생성
- 노무사에게 전달 가능한 형식으로 출력 (직원별 요약 포함)

## 5. 데이터베이스 설계

### 5.1 기존 테이블 (휴가 관리)
- **User**: 사용자 정보 (확장 필요)
- **LeaveLog**: 휴가 신청 기록

### 5.2 신규 테이블 (급여 관리)
- **MonthlyPayment**: 월별 급여 기록
- **Bonus**: 상여금/포상금 기록
- **SalesData**: 매출 데이터 (인센티브 계산용)
- **PayrollUpload**: 엑셀 파일 업로드 추적

### 5.3 확장된 User 테이블
기존 User 테이블에 급여 관리 관련 필드 추가:
- 입사일
- 기본급
- 인센티브 기준 (수식)
- 계좌번호 (선택사항)

## 6. 인센티브 계산 시스템

### 6.1 계산 방식
수식 문자열을 데이터베이스에 저장하고 매출 데이터에 따라 실시간 계산:

| 직원명 | 계산 수식 | 설명 |
|--------|-----------|------|
| 신홍재 | `sales * 0.15` | 본인 매출 15% |
| 정민정 | `sales * 0.13` | 본인 매출 13% |
| 오현중 | `sales > 5000 ? sales * 0.3 : 0` | 5000 초과 시 30% |
| 김채영 | `sales >= 8000 ? 2000000 : 0` | 8000 이상 시 정액 200만원 |

### 6.2 보안 고려사항
- 수식 파서를 통한 안전한 계산 (eval() 사용 금지)
- 허용된 변수와 연산자만 사용 가능
- 사용자 입력 검증 및 필터링

## 7. UI/UX 설계

### 7.1 현재 UI (Phase 1)
- Bootstrap 기반 반응형 웹 인터페이스
- 역할별 대시보드 (admin, manager, user)
- 기본적인 테이블 및 폼 인터페이스

### 7.2 목표 UI (Phase 2)
- React 기반 SPA (Single Page Application)
- AG Grid를 활용한 엑셀 스타일 테이블
- 월별 드롭다운으로 이동 가능
- 필터, 정렬, 셀 클릭 수정 가능
- 총합 자동 계산
- Excel 다운로드 기능

## 8. 보안 및 접근 제어

### 8.1 사용자 권한
- **admin**: 전체 시스템 접근, 사용자 관리, 휴가 승인, 급여 관리
- **manager**: 휴가 승인/거부, 부서 급여 데이터 조회
- **user**: 휴가 신청, 본인 휴가 이력 조회, 본인 급여 정보 조회

### 8.2 보안 기능
- 세션 기반 인증
- 역할 기반 권한 관리
- 수식 검증을 통한 코드 인젝션 방지
- 안전한 파일 업로드 처리
- 감사 로그 기능

## 9. 배포 및 운영

### 9.1 배포 환경
- **Target**: Synology NAS
- **Container**: Docker
- **Process Manager**: PM2
- **Database**: SQLite (시작) → PostgreSQL (확장 시)

### 9.2 운영 명령어
```bash
# 시작
./start.sh

# 중지
./stop.sh

# 재시작
./restart.sh

# 로그 확인
pm2 logs leave-payroll-system

# 데이터베이스 마이그레이션
flask db upgrade
```

## 10. 개발 로드맵

### Phase 1: 급여 관리 기능 추가 (2주)
- [ ] 급여 관리 모델 추가 (MonthlyPayment, Bonus, SalesData)
- [ ] 기본 급여 관리 라우트 구현
- [ ] 인센티브 계산 엔진 구현
- [ ] Excel 업로드 및 검증 기능
- [ ] PDF 보고서 생성 기능

### Phase 2: UI 현대화 (4주)
- [ ] React 개발 환경 구성
- [ ] AG Grid 통합
- [ ] 급여 관리 React 컴포넌트 개발
- [ ] 휴가 관리 React 컴포넌트 개발
- [ ] API 엔드포인트 분리 및 정리

### Phase 3: 최적화 및 확장 (2주)
- [ ] 성능 최적화
- [ ] 추가 보고서 기능
- [ ] 모바일 반응형 개선
- [ ] 데이터베이스 최적화

## 11. 품질 보증

### 11.1 테스트 전략
- 단위 테스트: 인센티브 계산 로직
- 통합 테스트: Excel 업로드 및 검증
- E2E 테스트: 전체 워크플로우

### 11.2 성능 목표
- 페이지 로드 시간 < 3초
- 대용량 Excel 파일 처리 < 30초
- 동시 사용자 수 최대 50명

## 12. 위험 관리

### 12.1 기술적 위험
- **위험**: 기존 Flask 시스템과 새로운 React 프론트엔드 간 통합 복잡성
- **대응**: 점진적 마이그레이션 전략 채택

### 12.2 데이터 위험
- **위험**: 급여 데이터 유출 및 무결성 문제
- **대응**: 암호화, 접근 권한 관리, 정기 백업

### 12.3 운영 위험
- **위험**: Synology NAS 환경에서의 성능 및 안정성
- **대응**: 모니터링 시스템 구축, 로드 테스트 수행

## 13. 결론

현재 운영 중인 Flask 기반 휴가 관리 시스템을 기반으로 급여 관리 기능을 단계적으로 추가하여 통합 인사관리 시스템을 구축합니다. 급여 관리 시스템의 제안된 기술 스택(React + AG Grid)을 점진적으로 도입하여 현대적이고 사용자 친화적인 시스템으로 발전시킬 계획입니다.