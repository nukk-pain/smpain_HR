# Payroll System Feature Plan

## ✅ Phase 1 완료된 기능 (2024-08-09)

### 1. 급여 기본 기능 (✅ COMPLETED)
- [x] **급여명세서 관리**: PDF 업로드/다운로드/삭제 완료
- [x] **급여 내역 조회**: 역할별 접근 제어 구현 (사용자는 본인만, 관리자는 전체)
- [x] **월별/연도별 급여 이력 관리**: 년도/월별 필터링 및 검색 기능 완료

### 2. 엑셀 데이터 연동 (✅ COMPLETED)
- [x] **엑셀 파일 업로드로 급여 내역 일괄 등록**: 듀얼로우 형식 지원, 배치 처리
- [x] **엑셀 데이터 export**: 필터링된 데이터 Excel 내보내기 완료
- [x] **데이터 검증**: 파일 형식, 필수 필드, 중복 체크 구현

### 3. PDF 급여명세서 관리 (✅ COMPLETED)
- [x] **PDF 급여명세서 업로드 기능**: 파일 검증 및 보안 처리 완료
- [x] **직원별 개인 급여명세서 조회**: 사용자는 본인 급여명세서만 조회 가능
- [x] **Admin 전체 급여명세서 관리 및 조회**: 관리자 전체 PDF 관리 기능 완료

### 4. 급여 계산 및 관리 (✅ COMPLETED)
- [x] **급여 CRUD**: 생성/조회/수정/삭제 완전 구현
- [x] **자동 계산**: 총 수당, 총 공제, 실수령액 자동 계산
- [x] **수당 관리**: 시간외수당, 직책수당, 식대, 교통비, 기타수당 지원
- [x] **공제 관리**: 4대보험(국민연금, 건강보험, 고용보험), 소득세, 지방소득세 지원
- [x] **상태 관리**: pending → approved → paid → cancelled 워크플로우

### 5. 보안 및 권한 관리 (✅ COMPLETED)
- [x] **역할별 접근 권한**: User(본인만), Admin/HR(전체) 구분 완료
- [x] **입력 검증 및 보안**: XSS 방지, 입력 살균, 파일 검증 완료
- [x] **API 보안**: JWT 인증, 권한 체크, 속도 제한 완료
- [x] **감사 추적**: 생성/수정/삭제 이력 추적 완료

## 📋 구현 현황 요약 (Phase 1)

### ✅ 구현 완료된 핵심 기능
1. **백엔드 API**: 10개 엔드포인트 (CRUD + Excel + PDF)
2. **프론트엔드 UI**: 4개 페이지 + 4개 컴포넌트 완성
3. **테스트 커버리지**: 49개 단위 테스트 + 22개 통합 테스트
4. **문서화**: 500+ 라인 API 문서 완성
5. **보안**: 인증, 권한, 검증, 감사 로그 완료

### 🛠️ 기술적 구현 사항
- **Repository 패턴**: PayrollRepository, PayrollTemplateRepository, PayrollDocumentRepository
- **Excel 처리**: 듀얼로우 형식 파싱 지원 (LaborConsultantParser)
- **파일 관리**: PDF 업로드/다운로드/삭제 완전 구현
- **계산 엔진**: 수당/공제/실수령액 자동 계산
- **UI/UX**: AG Grid 테이블, 실시간 필터링, 드래그앤드롭 업로드

### 📊 성과 지표
- **API 테스트**: 71개 모든 테스트 통과
- **보안 테스트**: XSS, 입력 검증, 파일 검증 완료
- **성능**: 페이지네이션, 캐싱, 가상화 적용
- **사용성**: 역할별 UI, 실시간 검색, 내비게이션 완료

---

## 🔮 Future Phase 제안 기능

### Phase 2: 고급 자동화 (2-3개월)
### 4. 급여 계산 고도화
- [ ] **기본급 관리**: 직급별/부서별 기본급 설정
- [ ] **수당 관리**: 
  - 시간외 수당 자동 계산
  - 야간/휴일 근무 수당
  - 직책 수당
  - 성과급/인센티브
- [ ] **공제 항목 자동 계산**:
  - 4대 보험료 (국민연금, 건강보험, 고용보험, 산재보험)
  - 소득세/지방소득세
  - 기타 공제 항목

### 5. 급여 승인 워크플로우
- [ ] **급여 산출 프로세스**:
  - 담당자 급여 산출 → 팀장 검토 → HR 승인 → 최종 확정
- [ ] **수정 이력 관리**: 누가, 언제, 무엇을 수정했는지 추적
- [ ] **승인 알림**: 이메일/앱 알림 기능

### 6. 급여 분석 및 리포트
- [ ] **급여 통계 대시보드**:
  - 부서별/직급별 평균 급여
  - 급여 증감 추이
  - 인건비 총액 및 예산 대비 실적
- [ ] **급여 비교 분석**: 
  - 전월/전년 대비 비교
  - 동일 직급 평균 대비 비교
- [ ] **연말정산 지원**: 연간 급여 총액 및 공제 내역 제공

### 7. 급여 지급 관리
- [ ] **지급 일정 관리**: 월별 급여일 설정 및 자동 알림
- [ ] **지급 방법 관리**: 
  - 계좌 정보 등록/변경
  - 복수 계좌 분할 지급 (예: 급여통장/저축통장)
- [ ] **지급 확인**: 실제 지급 완료 체크 기능

### 8. 보안 및 권한 관리
- [ ] **역할별 접근 권한**:
  - User: 본인 급여만 조회
  - Admin/HR: 전체 급여 관리
- [ ] **민감 정보 암호화**: 급여 데이터 암호화 저장
- [ ] **접근 로그**: 급여 정보 조회/수정 이력 추적

### 9. 모바일 지원
- [ ] **모바일 급여명세서**: 스마트폰에서 급여명세서 조회
- [ ] **푸시 알림**: 급여 입금 알림
- [ ] **전자 서명**: 급여명세서 확인 서명

### 10. 외부 시스템 연동
- [ ] **은행 API 연동**: 급여 이체 자동화
- [ ] **국세청 연동**: 원천징수 신고 자동화
- [ ] **근태 시스템 연동**: 출퇴근 기록과 연계한 급여 계산

### 11. 급여 시뮬레이션
- [ ] **급여 인상 시뮬레이션**: 인상률 적용 시 예상 인건비 계산
- [ ] **신규 채용 영향 분석**: 신규 인력 채용 시 인건비 변화 예측
- [ ] **What-if 분석**: 다양한 시나리오별 급여 변화 분석

### 12. 법규 준수 및 감사
- [ ] **최저임금 준수 체크**: 최저임금 미달 자동 경고
- [ ] **근로기준법 준수**: 법정 수당 지급 여부 체크
- [ ] **감사 추적**: 모든 급여 관련 활동 로그 보관

## 구현 우선순위 제안

### Phase 1 (핵심 기능) - 1~2개월
1. 급여 기본 정보 관리 (기본급, 수당, 공제)
2. 엑셀 업로드/다운로드 기능
3. 급여명세서 조회 (권한별)
4. PDF 급여명세서 업로드/조회

### Phase 2 (자동화) - 2~3개월
5. 급여 자동 계산 기능
6. 4대 보험료/세금 자동 계산
7. 급여 승인 워크플로우
8. 기본 리포트 및 통계

### Phase 3 (고급 기능) - 3~4개월
9. 급여 분석 대시보드
10. 모바일 지원
11. 외부 시스템 연동
12. 급여 시뮬레이션

## 기술적 고려사항

### 백엔드
- [ ] 급여 계산 엔진 개발
- [ ] 배치 처리 시스템 (월말 급여 계산)
- [ ] 데이터 암호화 및 보안
- [ ] API 권한 관리 강화

### 프론트엔드
- [ ] 급여 대시보드 UI
- [ ] 엑셀/PDF 업로드 컴포넌트
- [ ] 급여명세서 뷰어
- [ ] 모바일 반응형 디자인

### 데이터베이스
- [ ] payroll 컬렉션 스키마 설계
- [ ] payroll_templates (급여 구조 템플릿)
- [ ] payroll_history (급여 이력)
- [ ] payroll_documents (급여명세서 파일)

## 결정 필요 사항

### 1. 급여 계산 방식
**장점/단점 분석:**
- **Option A: 완전 자동 계산**
  - 장점: 효율적, 일관성, 오류 감소
  - 단점: 초기 설정 복잡, 예외 처리 어려움
  - 📌 **추천**: 장기적으로 가장 효율적

- **Option B: 반자동 (엑셀 업로드 + 검증)**
  - 장점: 기존 프로세스 유지, 유연성
  - 단점: 수동 작업 필요, 오류 가능성

### 2. 급여명세서 형식
**장점/단점 분석:**
- **Option A: PDF 업로드 방식**
  - 장점: 기존 양식 그대로 사용
  - 단점: 검색/분석 어려움

- **Option B: 시스템 내 생성**
  - 장점: 데이터 활용 가능, 일관된 형식
  - 단점: 개발 공수 증가
  - 📌 **추천**: 데이터 활용성이 높음

### 3. 권한 관리 수준
**장점/단점 분석:**
- **Option A: 단순 권한 (본인/전체)**
  - 장점: 구현 간단, 관리 용이
  - 단점: 세밀한 통제 불가

- **Option B: 세분화된 권한**
  - 장점: 유연한 권한 관리
  - 단점: 복잡도 증가
  - 📌 **추천**: 중간 관리자 권한 필요시 유용

## 다음 단계

1. 우선순위 확정
2. Phase 1 상세 요구사항 정의
3. 데이터베이스 스키마 설계
4. API 엔드포인트 설계
5. UI/UX 목업 작성